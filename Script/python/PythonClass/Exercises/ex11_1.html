<html>
<head>
<title>Python Training Exercises - Exercise 11.1</title>
</head>

<body>
<h1>Exercise 11.1</h1>

<table width=600 bgcolor="#e0e0ff" border=1 cellpadding=20>
<tr>
<td>
<b>Objectives:</b>
<ul>
<li>A small taste of network programming in Python.</li>
<li>Build an XML-RPC server that implements a simple key-value store</li>
</ul>
<p>
<b>Files Created:</b> <tt>PythonClass/kvstore.py</tt>

<p>
<b>Files Modified:</b> None

</td>
</tr>
</table>

<p>
<b>(a) Creating an XML-RPC server</b>

<p>
XML-RPC makes it easy to build programs where you can carry
out various operations remotely.  In this exercise,we'll build a 
server that operates as a simple key-value store.
</p>

<p>
First, create a file <tt>kvstore.py</tt> that contains the
following code:</p>

<blockquote>
<table>
  <tr><td>
    <pre>
# kvstore.py
#
# A simple key-value store using XML-RPC

# Internal dictionary that stores the actual data
_store = {}

# Functions that save, load, and delete contents
def save(key,value):
    _store[key] = value

def load(key):
    return _store.get(key,None)

def delete(key):
    if key in _store:
        del _store[key]

if __name__ == '__main__':
    from SimpleXMLRPCServer import SimpleXMLRPCServer
    serv = SimpleXMLRPCServer(("",15000),allow_none=True)
    serv.register_function(save)
    serv.register_function(load)
    serv.register_function(delete)
    serv.serve_forever()
</pre>
  </td></tr>
</table></blockquote>

<p>
Study this code carefully.   It defines three functions; save()
which stores an item in a dictionary, load() which returns the contents of
an item, and delete() which deletes an item.
</p>

<P>
In a <b>separate terminal window</b> (not IDLE), run the above
program.   It's not going to do anything until we connect to it and start
issuing commands.   See the next part.
</p>

<p>
<b>(b) Interacting with the XML-RPC server</b>
</p>

<p>
Now, in IDLE or a separate terminal window, launch Python and connect
to the server you just launched.
</p>

<blockquote>
<pre>
>>> <b>from xmlrpclib import ServerProxy</b>
>>> <b>s = ServerProxy("http://localhost:15000")</b>
>>>
</pre>
</blockquote>

<p>
Now, start executing some commands:
</p>

<blockquote>
<pre>
>>> <b>s.save("name","Guido")</b>
>>> <b>s.save("nameserver","8.8.8.8")</b>
>>> <b>s.save("ports", [4050,5100,5200])</b>
>>>
</pre>
</blockquote>

<p>
In yet another terminal window, launch Python and type these statements:
</p>


<blockquote>
<pre>
>>> <b>from xmlrpclib import ServerProxy</b>
>>> <b>s = ServerProxy("http://localhost:15000")</b>
>>> <b>s.load("name")</b>
'Guido'
>>> <b>s.load("nameserver")</b>
'8.8.8.8.8'
>>> <b>s.load("ports")</b>
[4050, 5100, 5200]
>>>
</pre>
</blockquote>

<p>
Now, why would you want to have such a key-value server?   In
a distributed system, you could use such a server to collect commonly shared
data such as configuration parameters, machine status, or other
details.  You could even build a simple in-memory database.   More
sophisticated key-value stores are also the basis of so-called "NoSQL"
databases.</p>

<p>
<b>SPECIAL TOPIC:</b> <a href="network.html">Advanced Networks</a>.
This section covers some additional network-related topics including
advanced uses of <tt>urllib</tt> and information on how to use SSL.
</p>

<hr>
[ <a href="index.html">Index</a> | <a
href="soln11_1.html">Solution</a>
| <a href="ex10_6.html">Back</a> | <a href="ex11_2.html">Next</a> ]
</body>
</html>
