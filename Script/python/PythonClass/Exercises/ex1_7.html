<html>
<head>
<title>Python Training Exercises - Exercise 1.7</title>
</head>

<body>
<h1>Exercise 1.7</h1>

<table width=600 bgcolor="#e0e0ff" border=1 cellpadding=20>
<tr>
<td>
<b>Objectives:</b>
<ul>
<li>How to define a simple function.
<li>Using a function to perform repeated calculations.
<li>Ignoring bad input data by catching and ignoring exceptions.
<li>Using a library module.
</ul>
<p>
<b>Files Created:</b> None. You should edit <tt>PythonClass/pcost.py</tt>

</td>
</tr>
</table>

<p><b>(a) Defining a function</b>

<P>You can define a simple function using the <tt>def</tt> statement.
For example, try this:
</p>

<blockquote>
<pre>
>>> <b>def say_hello(name):
       print "Hello", name</b>

>>> <b>say_hello("Guido")</b>
Hello Guido
>>> <b>say_hello("Paula")</b>
Hello Paula
>>>
</pre>
</blockquote>

<p>
Take the code you wrote in the last exercise and write a
function <tt>portfolio_cost(filename)</tt> that takes a filename as
input, reads the portfolio data in that file, and returns the total
cost of the portfolio.  

<p>
If you create a <tt>.py</tt> file that only contains a function definition, the interpreter has
to <b>run</b> that file in order for
the function to be available for you to use.  If you're
in IDLE, simply run the file that contains the function definition. 
If you working on the Unix command line, run python using the <tt>-i</tt>
option such as <tt>python -i pcost.py</tt>.  Alternatively, if you're already
working in the interpreter, you can run the contents of a file using <tt>execfile()</tt> like this:


<blockquote>
<pre>
>>> <b>execfile("pcost.py")</b>
>>> 
</pre>
</blockquote>

<P>
Try your new function by running your code (using one of the above
techniques) and then trying it out at the interactive Python prompt:

<blockquote>
<pre>
>>> <b>portfolio_cost("Data/portfolio.dat")</b>
44671.15
>>> 
</pre>
</blockquote>

<p>
What happens if you try your function on a file with some missing
fields?

<blockquote>
<pre>
>>> <b>portfolio_cost("Data/portfolio3.dat")</b>
... see what happens (hint: it doesn't work) ...
>>> 
</pre>
</blockquote>

<p>
<b>(b) Adding some error handling</b>

<p>
Modify your function slightly so that it is able to recover
from lines with bad data.
For example, the conversion functions <tt>int()</tt> and <tt>float()</tt> raise
a <tt>ValueError</tt> exception if they can't convert the input.   Use <tt>try</tt> and
<tt>except</tt> to catch and print a warning message about lines
that can't be parsed.

<p>
Try reading the <tt>Data/portfolio3.dat</tt> file again:

<blockquote>
<pre>
>>> <b>portfolio_cost("Data/portfolio3.dat")</b>
Couldn't parse: C - 53.08

Couldn't parse: DIS - 34.20

Couldn't parse: GE - 37.23

...
12125.88
>>> 
</pre>
</blockquote>

<p>
What happens if you run your function on a file containing a few blank lines?
</p>

<blockquote>
<pre>
>>> <b>portfolio_cost("Data/portfolioblank.dat")</b>
... see what happens (it fails) ...
>>>
</pre>
</blockquote>

<p>
Modify your code so that it ignores blank lines.  One way to do
this is to add an exception handler for catching <tt>IndexError</tt>
and ignoring exceptions. 
</p>

<p>
<b>(c) Using a library function</b>

<p>
The library module <tt>glob</tt> has a function called <tt>glob()</tt> which can
be used to return a list of filenames that match a pattern.  Try it out:

<blockquote>
<pre>
>>> <b>import glob</b>
>>> <b>filelist = glob.glob("Data/portfolio*.dat")</b>
>>> <b>filelist</b>
... look at the output ...
>>>
</pre>
</blockquote>

Modify your program above to print out the cost of all portfolio files returned by the
above <tt>glob()</tt> operation.

<P>
<b>(d) Where am I?  How did I get here?</b>

<P>
File operations such as <tt>open()</tt> always look for files relative
to the "current working directory."   Try using the <tt>os</tt> module to find
out where the interpreter is currently working:

<blockquote>
<pre>
>>> <b>import os</b>
>>> <b>os.getcwd()</b>
'C:\\PythonClass'
>>>
</pre>
</blockquote>

<p>
Try changing the working directory and doing a file operation:

<blockquote>
<pre>
>>> <b>os.chdir("Data")</b>
>>> <b>f = open("portfolio.dat")</b>
>>> <b>print f.read()</b>
AA 100 32.20
IBM 50 91.10
CAT 150 83.44
MSFT 200 51.23
...

>>>
</pre>
</blockquote>

<p>
Note: If you are having trouble editing, running, or locating files, you might use these two
library functions to help solve the problem.

<hr>
[ <a href="index.html">Index</a> | <a href="soln1_7.html">Solution</a>
| <a href="ex1_6.html">Back</a> | <a href="ex2_1.html">Next</a> ]
</body>
</html>
