<html>
<head>
<title>Python Training Exercises - Exercise 2.2</title>
</head>

<body>
<h1>Exercise 2.2</h1>

<table width=600 bgcolor="#e0e0ff" border=1 cellpadding=20>
<tr>
<td>
<b>Objectives:</b>
<ul>
<li>How to read data from a file into memory.
<li>Using lists and tuples to represent the contents of a column-oriented datafile as a matrix (or 2-d array) of values--similar to
how data is organized in a spreadsheet.
<li>Using lists and dictionaries to represent the contents of a column-oriented data file as a list of rows with named fields--similar
to how you might work with data stored in a database.
<li>Using a dictionary to hold data where you want to perform fast random lookups.
</ul>
<p>
<b>Files Created:</b> <tt>PythonClass/report.py</tt>

</td>
</tr>
</table>

<p>
<b>(a) A List of Tuples</b>

<p>
The file <tt>Data/portfolio.dat</tt> contains a list of
stocks in a portfolio.  In <a href="ex1_7.html">Exercise 1.7</a>, you
wrote a function <tt>portfolio_cost(filename)</tt> that read this file
and performed a simple calculation.  Your code should have looked
something like this:
</p>

<blockquote>
<table><tr><td><pre>
# pcost.py

def portfolio_cost(filename):
    '''Computes the total cost (shares*price) of a portfolio file'''
    total_cost = 0.0

    f = open(filename)
    for line in f:
        fields = line.split()
        nshares    = int(fields[1])
        price      = float(fields[2])
        total_cost = total_cost + nshares*price
    f.close()
    return total_cost
</pre>
</td></tr></table>
</blockquote>

<p>
Using this code as a guide, create a file <tt>report.py</tt>. In that file, define a
function <tt>read_portfolio(filename)</tt> that opens a given
portfolio file and reads it into a list of tuples.</p>

<p>
To do this, you're going to make a few minor modifications to the above code.
First, instead defining <tt>total_cost = 0</tt>, you'll make a
variable that's initially set to an empty list. For example:
</p>

<blockquote>
<pre>
portfolio = []
</pre>
</blockquote>

<p>
Next, instead of totaling up the cost,
you'll make a tuple for each line of the file and append it to the list.  For example:
</p>
<blockquote>
<pre>
for line in f:
    fields = line.split()
    holding = (fields[0], int(fields[1]), float(fields[2]))
    portfolio.append(holding)
</pre>
</blockquote>

<p>
Finally, you'll return the resulting <tt>portfolio</tt> list.
</p>

<p>
Experiment with your function interactively (just a reminder that in order to do this, you
first have to <b>run</b> the <tt>report.py</tt> program in the interpreter):

<blockquote>
<pre>
>>> <b>portfolio = read_portfolio("Data/portfolio.dat")</b>
>>> <b>for s in portfolio:</b>
        <b>print "s =", s</b>

... look at the output ...
>>>
>>> <b>portfolio[0]</b>
('AA', 100, 32.2)
>>> <b>portfolio[1]</b>
('IBM', 50, 91.1)
>>> <b>portfolio[1][1]</b>
50
>>> <b>total = 0.0</b>
>>> <b>for s in portfolio:</b>
        <b>total += s[1]*s[2]</b>

>>> <b>print total</b>
44671.15
>>>
</pre>
</blockquote>

<p>
This list of tuples that you have created is very similar to a
matrix or 2-D array.   For example, you can access a specific
column and row using a lookup such as <tt>portfolio[<em>row</em>][<em>column</em>]</tt>
where <tt><em>row</em></tt> and <tt><em>column</em></tt> are
integers.</p>

<p>
That said, you can also rewrite the last for-loop using a statement
like this:
</p>

<blockquote>
<pre>
>>> <b>total = 0.0</b>
>>> <b>for name, shares, price in portfolio:
          total += shares*price</b>

>>> <b>print total</b>
44671.15
>>>
</pre>
</blockquote>

<p>
<b>(b) A List of Dictionaries</b>

<p>
Take the function you wrote in part (a) and modify to represent each
stock in the portfolio with a dictionary instead of a tuple.  In this
dictionary use the fieldnames of "name", "shares", and "price" to
represent the different columns in the input file. 

<p>
Experiment with this new function in the same manner as you did in part (a).


<blockquote>
<pre>
>>> <b>portfolio = read_portfolio("Data/portfolio.dat")</b>
>>> <b>for s in portfolio:</b>
        <b>print "s =", s</b>

... look at the output ...
>>> <b>portfolio[0]</b>
{'price': 32.2, 'name': 'AA', 'shares': 100}
>>> <b>portfolio[1]</b>
{'price': 91.1, 'name': 'IBM', 'shares': 50}
>>> <b>portfolio[1]['shares']</b>
50
>>> <b>total = 0.0</b>
>>> <b>for s in portfolio:</b>
        <b>total += s['shares']*s['price']</b>

>>> <b>print total</b>
44671.15
>>>
</pre>
</blockquote>

Here, you will notice that the different fields for each entry are
accessed by key names instead of numeric column numbers.  This is often
preferred because the resulting code is easier to read later.

<p>
<b>(c) Dictionaries as a container</b>

<p>
A dictionary is a useful way to keep track of items where you want to look up
items using an index other than an integer.   In the Python shell, try playing with 
a dictionary:

<blockquote>
<pre>
>>> <b>prices = { }</b>
>>> <b>prices['IBM'] = 92.45</b>
>>> <b>prices['MSFT'] = 45.12</b>
>>> <b>prices</b>
... look at the result ...
>>> <b>prices['IBM']</b>
92.45
>>> <b>prices['AAPL']</b>
... look at the result ...
>>> <b>'AAPL' in prices</b>
False
>>>
</pre>
</blockquote>

<p>
The file <tt>Data/prices.csv</tt> that you scraped off the web contains a series of lines with
stock prices.  The file might look something like this:

<blockquote>
<pre>
"AA",9.22
"AXP",24.85
"BA",44.85
"BAC",11.27
"C",3.72
...
</pre>
</blockquote>

Write a function <tt>read_prices(filename)</tt> that reads a set of prices
such as this into a dictionary where the 
keys of the dictionary are the stock names and the values in the
dictionary are the stock prices.   To do this, start with an empty dictionary
and start inserting values into it just as you did above (you'll be reading the values
from a file however).   We'll use this data structure to quickly
lookup the price of a given stock name.

<p>
A few little tips that you'll need for this part. First, to split a string using
a different separator, give an argument to <tt>split()</tt> like this:

<blockquote>
<pre>
>>> <b>line = '"GOOG",509.71'</b>
>>> <b>fields = line.split(',')</b>
>>> <b>fields</b>
['"GOOG"', '509.71']
>>>
</pre>
</blockquote>

Next, to get rid of the double quotes (") around the stock names, use the <tt>strip()</tt> method.
For example:

<blockquote>
<pre>
>>> <b>name = fields[0].strip('"')</b>
>>> <b>name</b>
'GOOG'
>>>
</pre>
</blockquote>

<p>
The other little complication is that the <tt>Data/prices.csv</tt>
file may have some blank lines in it.   One way to deal with this is
to simply use exception handling and ignore <tt>IndexError</tt>
exceptions:</p>

<blockquote>
<pre>
>>> <b>for line in open("Data/prices.csv"):
           fields = line.split(',')
           try:
                print fields[0], fields[1] # IndexError if line is blank
           except IndexError:
                pass
</b>
>>>
</pre>
</blockquote>

<p>
Once you have written your <tt>read_prices()</tt> function, test it interactively to make sure it works:

<blockquote>
<pre>
>>> <b>prices = read_prices("Data/prices.csv")</b>
>>> <b>prices['IBM']</b>
106.28
>>> <b>prices['MSFT']</b>
20.89
>>>
</pre>
</blockquote>

<p>
<b>(d) Finding out if you can retire</b>

<p>
Tie all of this work together by adding statements to your
<tt>report.py</tt> program that takes the list of stocks in part (b)
and the dictionary of prices and computes the current value of the
portfolio along with the gain/loss.

<hr>
[ <a href="index.html">Index</a> | <a href="soln2_2.html">Solution</a>
| <a href="ex2_1.html">Back</a> | <a href="ex2_3.html">Next</a> ]
</body>
</html>
