<html>
<head>
<title>Python Training Exercises - Exercise 2.6</title>
</head>

<body>
<h1>Exercise 2.6</h1>

<table width=600 bgcolor="#e0e0ff" border=1 cellpadding=20>
<tr>
<td>
<b>Objectives:</b>
<ul>
<li>Explore the power of having first-class objects.
</ul>
<p>
<b>Files Created:</b> None. 

<p>
<b>Files Modified:</b> None.
</td>
</tr>
</table>
<p>

<p>
<b>(a) First-class Data</b>

<p>
In the file <tt>Data/portfolio.dat</tt>, we
read data organized as columns that look like this:

<blockquote>
<pre>
AA 100 32.20
IBM 50 91.10
...
</pre>
</blockquote>

<P>
In previous code, we parsed this data by hard-coding all of the conversions.  For example:

<blockquote>
<pre>
fields = line.split()
name   = fields[0]
shares = int(fields[1])
price  = float(fields[2])
</pre>
</blockquote>

This kind of conversion can also be performed in a more clever manner
using some list basic operations. Make a Python list that contains the
names of the conversion functions you would use to convert each column
into the appropriate type:

<blockquote>
<pre>
>>> <b>coltypes = [str, int, float]</b>
>>>
</pre>
</blockquote>

The reason you can even create this list is that everything in Python is "first-class."  So, if you
want to have a list of functions, that's fine.  The items in the list
you created are functions for converting a value <tt>x</tt> into a given type (e.g., <tt>str(x)</tt>,
<tt>int(x)</tt>, <tt>float(x)</tt>).


<p>
Now, read a line from the above file and split it into a list of fields:

<blockquote>
<pre>
>>> <b>f = open("Data/portfolio.dat")</b>
>>> <b>line = next(f)</b>
>>> <b>fields = line.split()</b>
>>> <b>fields</b>
['AA', '100', '32.20']
>>>
</pre>
</blockquote>

<p>
Even though you read a line and split it into fields, this is not
enough.   For example, the numeric fields are still text strings which don't
allow any meaningful mathematical operations to be performed.  You
need to convert the numeric strings into numeric values first.</p>

<p>
Try the following operations to perform some conversions.   First, notice that the items in <tt>coltypes</tt> are meant to match up with the associated values in <tt>fields</tt>.  For example:</p>

<blockquote>
<pre>
>>> <b>coltypes[1]</b>
&lt;type 'int'>
>>> <b>fields[1]</b>
'100'
>>>
</pre>
</blockquote>

<p>
Try converting one of the values:</p>

<blockquote>
<pre>
>>> <b>coltypes[1](fields[1])</b>     # Same as int(fields[1])
100
>>>
</pre>
</blockquote>

<p>
Try converting a different value:</p>
</p>

<blockquote>
<pre>
>>> <b>coltypes[2](fields[2])</b>     # Same as float(fields[2])
32.2
>>>
</pre>
</blockquote>

<p>

Zip the column types with the fields and look at the
result:</p>

<blockquote>
<pre>
>>> <b>r = zip(coltypes,fields)</b>
>>> <b>r</b>
[(&lt;type 'str'>, 'AA'), (&lt;type 'int'>, '100'), (&lt;type 'float'>,'32.20')]
>>>
</pre>
</blockquote>

<p>
You will notice that this has paired a type conversion with a value.  For example, <tt>int</tt> is
paired with the value <tt>'100'</tt>.   The zipped list is useful if you want to perform
conversions on all of the values, one after the other.  Try this:</p>

<blockquote>
<pre>
>>> <b>row = []</b>
>>> <b>for cfunc, fval in zip(coltypes,fields):
         row.append(cfunc(fval))</b>  
...
>>> <b>row</b>
['AA', 100, 32.2]
>>>
</pre>
</blockquote>

<p>
Make sure you understand what's happening in the above code.  In the loop, the <tt>cfunc</tt> variable is
one of the type conversion functions (e.g., <tt>str</tt>, <tt>int</tt>, etc.) and the <tt>fval</tt> variable
is one of the values like <tt>'AA'</tt>, <tt>'100'</tt>.  The expression <tt>cfunc(fval)</tt> is simply converting
a value (kind of like a type cast).</p>

<p>
The above code can be compressed into a single list comprehension.  Try this:</p>

<blockquote>
<pre>
>>> <b>row = [cfunc(fval) for cfunc,fval in zip(coltypes,fields)]</b>
>>> <b>row</b>
['AA', 100, 32.2]
>>>
</pre>
</blockquote>

<p>
<b>(b) Making dictionaries</b>

<p>
The <tt>dict()</tt> function can easily make a dictionary if you have a sequence of
key names and values.   Define a variable like this:

<blockquote>
<pre>
>>> <b>colnames = ['name','shares','price']</b>
>>>
</pre>
</blockquote>

<p>
Suppose you wanted to take the list of converted values in part (a) and create a dictionary.
Here's how to do it:
</p>

<blockquote>
<pre>
>>> <b>row</b>
['AA', 100, 32.2]
>>> <b>dict(zip(colnames,row))</b>
{'price': 32.2, 'name': 'AA', 'shares': 100}
>>>
</pre>
</blockquote>

<p>
<b>(c) The Big Picture</b>
</p>

<p>
Using the techniques in this exercise, you could write statements that easily convert fields
from just about any column-oriented datafile into a Python dictionary.  Just to illustrate, suppose
you read data from a different datafile like this:
</p>

<blockquote>
<pre>
>>> <b>f = open("Data/dowstocks.dat")</b>
>>> <b>line = next(f)</b>
>>> <b>print line</b>
"AA",39.48,"6/11/2007","9:36am",-0.18,39.67,39.69,39.45,181800
>>>
</pre>
</blockquote>

<p>
Let's convert the fields using a similar trick:</p>

<blockquote>
<pre>
>>> <b>coltypes = [str,float,str,str,float,float,float,float,int]</b>
>>> <b>colnames = ['name','price','date','time','change','open','high','low','volume']</b>
>>> <b>fields = line.split(",")</b>
>>> <b>row = [cfunc(fval) for cfunc,fval in zip(coltypes,fields)]</b>
>>> <b>record = dict(zip(colnames,row))</b>
>>> <b>record</b>
{'volume': 181800, 'name': '"AA"', 'price': 39.48, 'high': 39.69,
'low': 39.45, 'time': '"9:36am"', 'date': '"6/11/2007"', 'open': 39.67,
'change': -0.18}
>>> <b>record['name']</b>
'"AA"'
>>> <b>record['price']</b>
39.48
>>>
</pre>
</blockquote>

<p>
Spend some time to ponder what you've done in this exercise.   We'll return to this a little later.
</p>

<p>
<b>Challenge:</b> Notice that certain fields such as "name", "date",
and "time" contain extra double-quotes in the data.  How would you go
about removing them from the data?</p>

<hr>
[ <a href="index.html">Index</a> | <a href="soln2_6.html">Solution</a>
| <a href="ex2_5.html">Back</a> | <a href="ex3_1.html">Next</a> ]
</body>
</html>
