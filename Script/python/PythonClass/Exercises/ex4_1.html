<html>
<head>
<title>Python Training Exercises - Exercise 4.1</title>
</head>

<body>
<h1>Exercise 4.1</h1>

<table width=600 bgcolor="#e0e0ff" border=1 cellpadding=20>
<tr>
<td>
<b>Objectives:</b>
<ul>
<li>How to create and use a library module.
<li>Using the <tt>import</tt> statement
</ul>
<p>
<b>Files Created:</b> None.

<p>
<b>Files Modified:</b>
<ul>
<li> <tt>PythonClass/report.py</tt>
<li> <tt>PythonClass/fieldparse.py</tt>
</ul>

</td>
</tr>
</table>

<p>

<table width = 600 bgcolor="#ffe0e0" border=1 cellpadding=20>
<tr>
<td>
<b>Caution:</b> For this exercise involving modules, it is
critically important to make sure you are running Python in proper
environment.

<p>
If you are using IDLE, make sure that it is running in the <b>SAME
DIRECTORY</b> as the directory where you are editing your solutions
(e.g., <tt>"C:\PythonClass"</tt>).  If you started IDLE by clicking on the
<tt>RunIDLE.pyw</tt> file, then it should already be set up.

<p>
If you're not exactly sure where IDLE is running, restart the Python
shell, import the <tt>os</tt> module and type <tt>os.getcwd()</tt> to
get the current working directory.  If it's different than where you
are saving files, you'll need to quit IDLE and restart it from your
working directory.

<p>
If you are unable to change the configuration of IDLE, you will have to manually adjust the system 
search path to load modules from the Python shell.  For example:

<blockquote>
<pre>
>>> <b>import sys</b>
>>> <b>sys.path.insert(0,"C:/PythonClass")</b>
>>>
</pre>
</blockquote>
</td>
</tr>
</table>

<p>

In section 3, we created a general purpose function
<tt>parse()</tt> for parsing the contents of datafiles.  Now, we're going to see how
to use that function in other programs.

<p>
Before beginning, restart the Python shell.    To do this, first click in the window that has the interactive Python shell
to make it active.  Then, go up to the menu bar and look for the "Shell" option.  Select that and click on the "Restart Shell" option.
If this works, you should get a message like this:

<blockquote>
<pre>
>>> ================================ RESTART ================================
>>> 
</pre>
</blockquote>

<p>Once you've done that, try importing some of the programs you
previously wrote.  You should see their output exactly as before.  Just
emphasize, importing a module runs its code.</p>

<blockquote>
<pre>
>>> <b>import bounce</b>
... watch output ...
>>> <b>import mortgage</b>
... watch output ...
>>> <b>import report</b>
... watch output ...
>>>
</pre>
</blockquote>
<p>
If none of this works, you're probably running IDLE or Python in the
wrong directory.  See the big red warning box above (also make sure
the files actually exist--in case you skipped those exercises).
</p>

<p>
Now, try importing your fieldparse module and getting some help on it.
</p>
<blockquote>
<pre>
>>> <b>import fieldparse</b>
>>> <b>help(fieldparse)</b>
... look at the output ...
>>> <b>dir(fieldparse)</b>
... look at the output ...
>>>
</pre>
</blockquote>

<p>
Try using the module to read some data:

<blockquote>
<pre>
>>> <b>portfolio = fieldparse.parse(open("Data/portfolio.dat"),[str,int,float],['name','shares','price'])</b>
>>> <b>portfolio</b>
... look at the output ...
>>> <b>pricelist = fieldparse.parse(open("Data/prices.csv"),[str,float],sep=',')</b>
>>> <b>pricelist</b>
... look at the output ...
>>> <b>prices = dict(pricelist)</b>
>>> <b>prices</b>
... look at the output ...
>>> <b>prices['IBM']</b>
106.11
>>>
</pre>
</blockquote>

<p><b>(a) Using your module</b>
<p>

In section 2, you wrote a program <tt>report.py</tt> that produced a 
stock report like this:

<blockquote>
<pre>
<pre>
      Name     Shares      Price     Change 
---------- ---------- ---------- ---------- 
        AA        100      39.91       7.71
       IBM         50     106.11      15.01
       CAT        150      78.58      -4.86
      MSFT        200      30.47     -20.76
        GE         95      37.38      -2.99
      MSFT         50      30.47     -34.63
       IBM        100     106.11      35.67
</pre>
</blockquote>

Take that program and modify it so that all of the input file
processing is done using functions in your <tt>fieldparse</tt> module.
To do that, import <tt>fieldparse</tt> as a module and change
the <tt>read_portfolio()</tt> and <tt>read_prices()</tt> functions to
use the <tt>parse()</tt> function.   Use the interactive example at the start of this
exercise as a guide.

<p><b>(b) Using __main__</b>
<p>
In your <tt>report.py</tt> program, the very last statement runs the program on some sample
input files.  For example:

<blockquote>
<pre>
portfolio_report("Data/portfolio.dat","Data/prices.csv")
</pre>
</blockquote>

Change this statement so that it only executes if the <tt>report.py</tt> program is run
as the main script.  Now, try to load your <tt>report.py</tt> program in two different ways.
First, just run it as the main program by selecting "Run Module" in IDLE. If you are using
the Unix shell, type this:

<blockquote>
<pre> 
bash % <b>python report.py</b>
</pre>
</blockquote>

Next, restart Python and try loading it as a library module:

<blockquote>
<pre>
>>> ================================ RESTART ================================
>>> <b>import report</b>
>>>
</pre>
</blockquote>

If you have done this correctly, you will only get output when the program runs as main.  When imported as
a library module, you have to call the <tt>portfolio_report()</tt> function manually. For example:

<blockquote>
<pre>
>>> ================================ RESTART ================================
>>> <b>import report</b>
>>> <b>report.portfolio_report("Data/portfolio.dat","Data/prices.csv")</b>
... output here ...
>>>
</pre>
</blockquote>

<hr>
[ <a href="index.html">Index</a> | <a href="soln4_1.html">Solution</a>
| <a href="ex3_3.html">Back</a> | <a href="ex4_2.html">Next</a> ]
</body>
</html>
