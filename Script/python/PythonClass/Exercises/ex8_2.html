<html>
<head>
<title>Python Training Exercises - Exercise 8.2</title>
</head>

<body>
<h1>Exercise 8.2</h1>

<table width=600 bgcolor="#e0e0ff" border=1 cellpadding=20>
<tr>
<td>
<b>Objectives:</b>
<ul>
<li>Define a generator function that customizes iteration.
</ul>

<p>
<b>Files Created:</b> <tt>PythonClass/follow.py</tt>

<p>
<b>Files Modified:</b> None

</td>
</tr>
</table>

<p>
<b>(a) A Simple Generator</b>
</p>

<p>
If you ever find yourself wanting to customize iteration, you should
always think generator functions.  They're easy to write---simply make
a function that carries out the desired iteration logic and uses <tt>yield</tt>
to emit values.
</p>

<p>
For example, try this generator that allows you to iterate over a
range of numbers:
</p>

<blockquote>
<pre>
>>> <b>def irange(start,stop,step):
        while start < stop:
            yield start
            start += step</b>

>>> <b>for x in irange(0, 2, 0.25):
        print x,</b>

0 0.25 0.5 0.75 1.0 1.25 1.5 1.75
>>>
</pre>
</blockquote>

<p>
Bonus: Modify the above function so that it handles negative strides
correctly.  For example:
</p>

<blockquote>
<pre>
>>> <b>for x in irange(2, 0, -0.25):
        print x,</b>

2.0 1.75 1.5 1.25 1.0 0.75 0.5 0.25
>>>
</pre>
</blockquote>

<p>
Note: Don't spend too much time fiddling around with it though--move
on to the next part.
</p>

<p><b>(b) Monitoring streaming data</b></p>

<p>
Generators can be an interesting way to monitor real-time data sources
such as log files or stock market feeds.  In this exercise, we'll
explore this idea.  To start, follow the next instructions carefully.

<p>
The program <tt>Data/stocksim.py</tt> is a program that
simulates stock market data.  As output, the program constantly writes
real-time data to a file "stocklog.dat".  In a
command window (not IDLE) go into the <tt>Data/</tt> directory and run this program:

<blockquote>
<pre>
% <b>python stocksim.py</b>
</pre>
</blockquote>

<p>
If you are on Windows, just locate the <tt>stocksim.py</tt> program and double-click on it to run it.
Now, forget about this program (just let it run).  Using another
window, look at the file "Data/stocklog.dat" being written by the
simulator.  You should see new lines of text being added to the file
every few seconds.  Again, just let this program run in the
background---it will run for several hours (you shouldn't need to worry about it).
</p>

<p>
Once the above program is running, type the following commands to open
the file and seek to the very end:
</p>

<blockquote>
<table><tr><td>
<pre>
import os
f = open("Data/stocklog.dat")
f.seek(0,os.SEEK_END)   # Move file pointer 0 bytes from end of file
</pre>
</td></tr></table>
</blockquote>

<p>
Now, type the following statements to constantly read data written to
the end of the file and print them out.</p>

<blockquote>
<table><tr><td>
<pre>
while True:
    line = f.readline()
    if line != '':
         print line,
</pre>
</td></tr></table>
</blockquote>

<p>
If you have ever used the Unix <tt>tail -f</tt> command to watch a log-file, then the behavior of
our generator is similar.</p>

<p>
Note: The use of the <tt>readline()</tt> method in this example is
somewhat unusual in that it is not the usual way of reading lines from
a file (normally you would just use a <tt>for</tt>-loop).  However, in
this case, we are using it to repeatedly probe the end of the file to
see if more data has been added (<tt>readline()</tt> will either
return new data or an empty string).</p>

<p> In a file <tt>follow.py</tt>, define a generator function
<tt>follow()</tt> that produces lines of text written to the end of a
constantly updated log file. Your function should use the above code
as a guide.  Here's how the generator function should work: </p>

<blockquote>
<pre>
>>> <b>for line in follow("Data/stocklog.dat"):</b>
    <b>      print line,</b>
   
... Should see lines of output produced here ...
</pre>
</blockquote>

<p>
One critical feature of our generator function is that we can do more
than just simple printing.  For example, you can process the data in
various ways:
</p>

<blockquote>
<pre>
>>> <b>for line in follow("Data/stocklog.dat"):
        row = line.split(",")
        name = row[0].strip('"')
        price = float(row[1])
        change = float(row[4])
        print "%10s %10s %10s" % (name,price,change)</b>

       UTX      69.72      -0.51
        GE      37.14      -0.18
       JPM      50.26      -0.15
      MSFT      29.96      -0.09
       HPQ      45.62      -0.08
       AXP      62.41      -0.63
...
</pre>
</blockquote>

<hr>
[ <a href="index.html">Index</a> | <a href="soln8_2.html">Solution</a>
| <a href="ex8_1.html">Back</a> | <a href="ex8_3.html">Next</a> ]
</body>
</html>
