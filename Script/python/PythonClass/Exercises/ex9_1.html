<html>
<head>
<title>Python Training Exercises - Exercise 9.1</title>
</head>

<body>
<h1>Exercise 9.1</h1>

<table width=600 bgcolor="#e0e0ff" border=1 cellpadding=20>
<tr>
<td>
<b>Objectives:</b>
<ul>
<li>Using Python's built-in Template strings to perform $variable substitutions in text.
</ul>

<p>
<b>Files Created:</b> <tt>PythonClass/stockreport.py</tt>

<p>
<b>Files Modified:</b> None

</td>
</tr>
</table>

<p>
<b>The Problem with Printing</b>

<p>
Python is commonly used to write scripts that generate text such as
reports, forms, or web pages.
</p>

<p>
Create a file <tt>stockreport.py</tt> that contains the following
code:
</p>

<blockquote>
<table>
  <tr><td><pre>
# stockreport.py                                                                                                                                                                                                 

import sys
import urllib
import csv

if len(sys.argv) != 2:
    print >>sys.stderr,"Usage: %s symbol" % sys.argv[0]
    raise SystemExit(1)

symbol = sys.argv[1]

u      = urllib.urlopen("http://finance.yahoo.com/d/quotes.csv?f=snl1d1t1c1p2ohgv&s="+symbol)
colnames = ['symbol','name','price','date','time','change','percent','open','high','low','volume']
stocks = csv.DictReader(u,colnames)

for s in stocks:
    print "&lt;p>"
    print "&lt;b>%s (%s)&lt;/b>" % (s['symbol'],s['name'])
    print "&lt;font size=+2>&lt;b>%s&lt;/b>&lt;/font>" % (s['price'])
    print "%s (%s)" % (s['change'],s['percent'])
    print "%s %s&lt;br>" % (s['date'], s['time'])
    print "&lt;table>"
    print "&lt;tr>"
    print "&lt;td>Open:&lt;/td>&lt;td>%s&lt;/td>&lt;td>Volume:&lt;/td>&lt;td>%s&lt;/td>" % (s['open'],s['volume'])
    print "&lt;/tr>"
    print "&lt;tr>"
    print "&lt;td>High:&lt;/td>&lt;td>%s&lt;/td>&lt;td>Low:&lt;/td>&lt;td>%s&lt;/td>" % (s['high'],s['low'])
    print "&lt;/table>"
    print "&lt;/p>"
</pre></td></tr>
</table>
</blockquote>

<p>
This program is a command line tool that takes the name of a stock,
performs a query, and produces a fragment of HTML with information
about the stock.  To run this, you need to run it at the terminal
window, not IDLE.  Try it out:
</p>

<blockquote>
<pre>
bash % <b>python stockreport.py IBM</b>
&lt;p>
&lt;b>IBM (International Bus)&lt;/b>&lt;br>
&lt;font size=+2>&lt;b>126.02&lt;/b>&lt;/font>
+2.56 (+2.07%)
7/7/2010 2:16pm&lt;br>
&lt;table>
&lt;tr>
&lt;td>Open:&lt;/td>&lt;td>123.89&lt;/td>&lt;td>Volume:&lt;/td>&lt;td>3852924&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>High:&lt;/td>&lt;td>126.38&lt;/td>&lt;td>Low:&lt;/td>&lt;td>123.47&lt;/td>
&lt;/table>
&lt;/p>
bash %
</pre>
</blockquote>

<p>
Now, observe how this program is already a horrible mess.   Look at
all of those print statements and the embedded HTML.  What if you want
to make a change to the output format?  What if you wrote a 10000 line
program entirely in this style?   Would it be maintainable?   Probably
not.

<p>
<b>(a) Using Template Strings</b>
</p>

<p>
Modify the <tt>stockreport.py</tt> program above to produce its
output using a template string instead of print statements.
Specifically, define the output string as a template like this:
</p>

<blockquote>
<table>
  <tr><td><pre>
# stockreport.py
...
import string

output = string.Template("""
&lt;p>
&lt;b>$symbol ($name)&lt;/b>&lt;br>
&lt;font size=+2>&lt;b>$price&lt;/b>&lt;/font>
$change ($percent)
$date $time&lt;br>
&lt;table>
   &lt;tr>
      &lt;td>Open:&lt;/td>&lt;td>$open&lt;/td>&lt;td>Volume:&lt;/td>&lt;td>$volume&lt;/td>
   &lt;/tr>
   &lt;tr>
      &lt;td>High:&lt;/td>&lt;td>$high&lt;/td>&lt;td>Low:&lt;/td>&lt;td>$low&lt;/td>
   &lt;/tr>
&lt;/table>
&lt;/p>
""")
</pre></td></tr>
</table>
</blockquote>

<p>
Have the program call <tt>output.substitute()</tt> with appropriate
variables to produce the output.</p>

<p>
<b>(b) Using Template Files</b>
</p>

<p>
In part (a), the program still has the output hardwired into
the program.  Modify the program so that the output template is read
from a file <tt>stockreport_template.html</tt> instead.

<p>
<b>Discussion</b>

<p>
The use of templates is widespread in web programming
applications.  For instance, PHP and Microsoft's Active Server Pages
(ASP) are based on a similar concept.  Almost all of the web
programming frameworks for Python (e.g., Django, Turbogears, etc.)
also provide their own template engines.     

<hr>
[ <a href="index.html">Index</a> | <a href="soln9_1.html">Solution</a>
| <a href="ex8_4.html">Back</a> | <a href="ex9_2.html">Next</a> ]
</body>
</html>
