<html>
<head>
<title>Python Training Exercises - Exercise 9.2</title>
</head>

<body>
<h1>Exercise 9.2</h1>

<table width=600 bgcolor="#e0e0ff" border=1 cellpadding=20>
<tr>
<td>
<b>Objectives:</b>
<ul>
<li>See how to deal with file encodings with the io module.</li>
<li>Learn how to properly produce Unicode characters in HTML output.</li>
</ul>

<p>
<b>Files Created:</b> <tt>PythonClass/recipe.py</tt>

<p>
<b>Files Modified:</b> None

</td>
</tr>
</table>

<p>
A major problem with file I/O on modern systems is dealing with different encodings of text.  Although a lot of text is often encoded in ASCII
and other 8-bit character sets, if any kind of international characters are being used, you will start to work with files with various
forms of multi-byte character encodings.

<p>
<b>(a) Understanding the encoding problem</b>

<p>
Character encoding is a slightly different problem than the file format.  For example, suppose you're writing a program to 
parse CSV file such as <tt>Data/portfolio.csv</tt> which looks like this:

<blockquote>
<pre>
"AA",100,32.20
"IBM",50,91.10
"CAT",150,83.44
"MSFT",200,51.23
"GE",95,40.37
"MSFT",50,65.10
"IBM",100,70.44
</pre>
</blockquote>

You know that you can easily read the file contents, using code like this.  Try it out:

<blockquote>
<pre>
>>> <b>for line in open("Data/portfolio.csv"):</b>
         <b>fields = line.split(',')</b>
         <b>print fields</b>
   
... look at the output ...
>>>
</pre>
</blockquote>

The file <tt>Data/portfolio2.csv</tt> has the same portfolio data as above, but encoded in UTF-16, a multibyte character
encoding used for Unicode.  What happens if you try typing the same statements as above?

<blockquote>
<pre>
>>> <b>for line in open("Data/portfolio2.csv"):</b>
           <b>fields = line.split(',')</b>
           <b>print fields</b>
   
... look at the output ...
>>>
</pre>
</blockquote>

If you've done this correctly, you'll get a garbled mess.  The reason: characters aren't encoded in ASCII.  Now, try this:

<blockquote>
<pre>
>>> <b>import io</b>
>>> <b>for line in io.open("Data/portfolio2.csv","r",encoding="utf-16"):</b>
           <b>fields = line.split(u',')</b>
           <b>print fields</b>
   
... look at the output ...
>>>
</pre>
</blockquote>

<P>
Important lesson : Character encoding has nothing to do with the fact that the file is a CSV file.  It's simply an extra layer of 
complexity that has been added to characters in the file.
</p>

<p>
One other point: when working with Unicode, you should make sure you
use Unicode strings everywhere (hence the use of <tt>u','</tt> in the
split operation).
</p>

<p>
<b> (b) Encoding Unicode Characters in HTML Output</b>

<p>
Here is a program that is supposed to create an HTML file with a list of
ingredients for something tasty:

<blockquote>
<table><tr><td><pre>
# recipe.py

ingredients = [
    u"Avocado",
    u"Tomato",
    u"Red Onion",
    u"Jalape\u00f1o pepper",
    u"Cilantro",
    u"Sea Salt",
]

header = u"""
&lt;html>
&lt;body>
"""

footer = u"""
&lt;/body>
&lt;/html>
"""

f = open("output.html","w")
f.write(header)
for item in ingredients:
    f.write("&lt;li>%s&lt;/li>\n" % item)
f.write(footer)
f.close()

import webbrowser
import os
webbrowser.open("file:///"+os.path.abspath("output.html"))
</pre></td></tr></table>
</blockquote>

<p>
Copy the above program to a file <tt>recipe.py</tt> and run it.
Chances are, it will crash with an encoding error.
</p>

<p>
Your challenge:  Modify the above program so that it runs without
crashing and the resulting HTML renders the characters in the
ingredient list correctly.
</p>

<hr>
[ <a href="index.html">Index</a> | <a href="soln9_2.html">Solution</a>
| <a href="ex9_1.html">Back</a> | <a href="ex10_1.html">Next</a> ]
</body>
</html>
